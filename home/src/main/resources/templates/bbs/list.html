<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<!--/* layout/header.html의 head조각으로 head 태그를 바꾼다. */-->

<head th:replace="~{/layout/header::headFrag('BBS목록')}">


<body>

  <!--/* Variable Expression : ${} (값을 나타낼 때 사용) */-->

  <h1>BBS 목록보기</h1>
  
  <div>
    <a th:href="@{/bbs/write.do}">BBS작성하러가기</a>
  </div>
  
  <hr>
  
  <div>
    <!--/*
      th:text="단순텍스트"
      th:utext="HTML텍스트(태그가 포함된 텍스트)"
    */-->
  
    <div th:utext="${pagination}"></div>
    <table border="1">
      <thead>
        <tr>
          <td>순번</td>
          <td>작성자</td>
          <td>제목</td>
          <td>IP</td>
          <td>작성일자</td>
          <td></td>
        </tr>
      </thead>
      <tbody>
        <th:block th:each="bbs,vs:${bbsList}">
          <th:block th:if="${bbs.state == 1}">
            <!-- 게시글 내용 -->
            <tr class="list">
              <td th:text="${beginNo - vs.index}"></td>
              <td th:text="${bbs.writer}"></td>
              <td>
                <!-- DEPTH에 의한 들여쓰기 -->
                <!--/* 1부터 2까지 1씩 증가. 증가한 변수를 n으로 보내주겠다. */-->
                <!--/* 자바코드 : for(int n=1; n<=depth;n++),  1부터 detph까지 순차적으로 증가    */-->
                <!--/* 
                    &nbsp;&nbsp;&nbsp;를 데이터 3개라고 인식하고 있어서 '&nbsp;'+'&nbsp;'+'&nbsp;' 를 해줘야하는데 
                    이때 플러스(+)를 대신 해주는 게 '| |' 파이프이다. 파이프 안쪽의 데이터들을 연결(플러스로 연결) 해준다.
                */-->
                <th:block th:each="n:${#numbers.sequence(1,bbs.depth,1)}" th:text="|&nbsp;&nbsp;&nbsp;|"></th:block>
                <!-- 답글은 [Re] 표시하기 -->
                <th:block th:if="${bbs.depth > 0}" th:text="[Re]"></th:block>
                <!-- 제목 -->
                <span th:text="${bbs.title}"></span>
                <!-- 답글작성하기 버튼 -->
                <input type="button" value="답글" class="btn_reply">
              </td>
              <td th:text="${bbs.ip}"></td>
              <td th:text="${#dates.format(bbs.createdAt, 'yyyy/MM/dd HH:mm')}"></td>
              <td>
                <!-- 작성자만 삭제할 수 있게 if조건 걸기 -->
                <th:block th:if="${session.loginId == bbs.writer}">
                  <form class="frm_remove" method="post" th:action="@{/bbs/remove.do}">
                    <input type="hidden" name="bbsNo" th:value="${bbs.bbsNo}">
                    <button>삭제</button>
                  </form>
                </th:block>
              </td>
            </tr>
            <!-- 답글 작성 화면 -->
            <!-- 답글 달 때 필요한 데이터:원글의 DEPTH, GROUP_NO, GROUP_ORDER -->
            <tr class="write blind">
              <td colspan="6">
                <form method="post" th:action="@{/bbs/reply/add.do}">
                  <div>
                    <label for="writer">작성자</label>
                    <input id="writer" name="writer" required="required">
                  </div>
                  <div>
                    <label for="title">제목</label>
                    <input id="title" name="title" required="required">
                  </div>
                  <div>
                    <button>답글달기</button>
                    <!-- 원글의 depth, groupNo, groupOrder를 함께 보낸다. -->
                    <input type="hidden" name="depth" th:value="${bbs.depth}">
                    <input type="hidden" name="groupNo" th:value="${bbs.groupNo}">
                    <input type="hidden" name="groupOrder" th:value="${bbs.groupOrder}">
                  </div>
                </form>
              </td>
            </tr>
          </th:block>
          <th:blcok th:if="${bbs.state == 0}">
            <tr>
              <td th:text="${beginNo - vs.index}"></td>
              <td colspan="5">삭제된 게시글입니다.</td>
            </tr>
          </th:block>
        </th:block>
      </tbody>
    </table>
  </div>
  
</body>
</html>